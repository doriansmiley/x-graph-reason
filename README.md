# IMPORTANT
This project is an experiment. It is not functional. TODOs:
1. Get the RDF data properly imported. The current ingest algorithm is shit.
Refactor to use [`rdflib_neo4j`](https://neo4j.com/labs/rdflib-neo4j/1.0/gettingstarted/)
2. Verify the `ExternalContinualLearner` is functioning as designed and yielding relevant results. Built a better test
3. Once the KG is properly populated in Neo4J, verify `execute_neo4j_query` is working as designed
4. Test the viability of this approach at scale and its ability to absorb new facts 

# x-graph-reason
Demo app using InCA with Neo4J KG and RDF for exploring domian specific solution spaces
The `main.py` file contains a Flask-based API for managing and querying a knowledge graph using Neo4j and updating the graph using OpenAI embeddings.

## Environment Setup

1. `pip install -r requirements.txt`
1. Create the `app/.env` file and add the following vars:
```
NEO4J_URI=<YOUR_NEO4J_URI>
NEO4J_USERNAME=<YOUR_NEO4J_USERNAME>
NEO4J_PASSWORD=<YOUR_NEO4J_PWD>
AURA_INSTANCEID=<YOUR_NEO4J_INSTANCE_ID>
AURA_INSTANCENAME=<YOUR_NEO4J_INSTANCE_NAME>
OPENAI_API_KEY=<YOUR_OPENAI_KEY>
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
```

## Test
1. `pytest`

## Start the Flask API
```
python main.py
```

# Project Summary

## Intent of the Project

This project aims to leverage **In-Context Continual Learning Assisted by an External Continual Learner (InCA)** to generate knowledge graph queries that explore the solution space for a given input query. The system uses a hybrid approach involving RDF-based knowledge representation, Neo4j for graph storage and queries, and OpenAI embeddings for semantic understanding and in-context learning. It combines these tools to create a dynamic and continually improving knowledge graph that provides insightful answers to user queries.

### Reference
For more details on the InCA framework, refer to the paper:
**In-context Continual Learning Assisted by an External Continual Learner**  
*Saleh Momeni, Sahisnu Mazumder, Zixuan Ke, Bing Liu*  
[Read the paper here](https://arxiv.org/html/2412.15563v1)

---

## Workflow Overview

1. **Corpus Update**: Dynamically process and integrate new knowledge from a provided corpus into the RDF graph, Neo4j database, and External Continual Learner (ECL).
2. **Knowledge Querying**: Accept user queries and generate knowledge graph queries based on embeddings generated by OpenAI models and class proximity from the ECL.
3. **Continual Learning**: Ensure the knowledge graph is updated continually with new classes, relationships, and resolutions.

---

## Notional Example

### Input Query
**"Why was my claim denied?"**

### Sample Output
```json
{
  "results": [
    {
      "class": "Claim",
      "relationship": "adjustment",
      "target": "Exceeding allowed amount",
      "resolution": "Verify allowable amounts with the payor"
    },
    {
      "class": "Claim",
      "relationship": "preauthorization",
      "target": "Preauthorization not obtained",
      "resolution": "Submit preauthorization forms retroactively"
    }
  ]
}
```
## Sample Query
Query the knowledge graph using `query-knowledge-graph` route for solutions:
```
curl -X POST http://localhost:5000/query-knowledge-graph -H "Content-Type: application/json" -d '{
    "query": "Why was my claim denied?"
}'
```
Sample Output:
```
{
  "results": [
    {
      "class": "Claim",
      "relationship": "adjustment",
      "target": "Exceeding allowed amount",
      "resolution": "Verify allowable amounts with the payor"
    },
    {
      "class": "Claim",
      "relationship": "preauthorization",
      "target": "Preauthorization not obtained",
      "resolution": "Submit preauthorization forms retroactively"
    }
  ]
}
```

## Sample Corpus Update
Use the `/update-corpus` endpoint to add the new knowledge:
```
curl -X POST http://localhost:5000/update-corpus -H "Content-Type: application/json" -d '{
    "corpus": [
        "Claim denied due to adjustment required for exceeding allowed amount. Resolution: Verify allowable amounts with the payor.",
        "Claim denied because preauthorization was not obtained. Resolution: Submit preauthorization forms retroactively."
    ]
}'
```
This will cause the system to:
1. Create or update RDF triples representing claims, denial reasons, and resolutions.
2. Integrate new triples into Neo4j and update class embeddings in the ECL.
